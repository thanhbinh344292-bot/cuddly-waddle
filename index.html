<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TB49 AI - SI√äU C·∫§P</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: -apple-system, sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .nav { background: #111; border-bottom: 2px solid #222; padding: 10px 0; z-index: 10; }
        header { text-align: center; color: #007aff; font-weight: 800; margin-bottom: 8px; font-size: 1.2rem; }
        .tools { display: flex; gap: 8px; overflow-x: auto; padding: 0 10px; }
        #v { flex: 1; display: flex; align-items: center; justify-content: center; background: #050505; position: relative; padding: 5px; }
        canvas { max-width: 100%; max-height: 100%; border-radius: 10px; border: 1px solid #333; }
        #loading { position: absolute; display: none; color: #007aff; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 10px; border: 1px solid #007aff; z-index: 20; }
        #chat { height: 180px; background: #000; border-top: 2px solid #222; display: flex; flex-direction: column; }
        #log { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; color: #ccc; line-height: 1.4; }
        .in-box { display: flex; padding: 10px; gap: 8px; background: #111; }
        button { background: #222; color: #fff; border: 1px solid #444; padding: 10px 15px; border-radius: 10px; font-weight: bold; white-space: nowrap; }
        button:active { background: #007aff; transform: scale(0.95); }
        input { flex: 1; background: #222; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; outline: none; font-size: 16px; }
    </style>
</head>
<body>
    <div class="nav">
        <header>THANHBINH49 AI PRO</header>
        <div class="tools">
            <button onclick="document.getElementById('f').click()">üìÇ M·ªû</button>
            <button onclick="ef(1.5)" style="color:#ffcc00">üî• BOOST</button>
            <button onclick="boom()" style="background:#ff3b30; border:none">‚ò¢Ô∏è T·ª∞ H·ª¶Y</button>
            <button onclick="rs()">üîÑ RESET</button>
            <button onclick="sv()" style="background:#007aff; border:none">üíæ L∆ØU</button>
        </div>
    </div>
    <div id="v">
        <canvas id="c"></canvas>
        <div id="loading">‚ö° ƒêANG X·ª¨ L√ù...</div>
    </div>
    <input type="file" id="f" hidden onchange="ld(event)">
    <div id="chat">
        <div id="log">AI: ƒê√£ nh·∫≠n l·ªánh s·∫øp! Em ƒëang ch·∫°y b·∫±ng "Pin" Gemini c·ª±c m·∫°nh.</div>
        <div class="in-box">
            <input type="text" id="m" placeholder="Chat ho·∫∑c g√µ 'v·∫Ω con r·ªìng'...">
            <button onclick="go()" style="background:#007aff; border:none; width:50px; border-radius:10px">üöÄ</button>
        </div>
    </div>
<script>
    const API_KEY = "AIzaSyAosEJtRm3eHM-zVmsIzAMfipoU3v9wEek";
    const cv = document.getElementById('c'), x = cv.getContext('2d'), ldBox = document.getElementById('loading');
    let ori = null;

    function ld(e) {
        const r = new FileReader();
        r.onload = (ev) => {
            const img = new Image();
            img.onload = () => {
                const ratio = Math.min(window.innerWidth/img.width, 1000/img.height, 1);
                cv.width = img.width * ratio; cv.height = img.height * ratio;
                x.drawImage(img, 0, 0, cv.width, cv.height); ori = img;
            };
            img.src = ev.target.result;
        };
        r.readAsDataURL(e.target.files[0]);
    }

    function ef(t) {
        if(!ori) return;
        x.drawImage(ori, 0, 0, cv.width, cv.height);
        const d = x.getImageData(0,0,cv.width,cv.height), data = d.data;
        for(let i=0; i<data.length; i+=4){ data[i]*=t; data[i+1]*=t; data[i+2]*=t; }
        x.putImageData(d,0,0);
    }

    function boom() { if(confirm("H·ªßy h·∫øt b·∫±ng ch·ª©ng nh√© s·∫øp?")) { x.clearRect(0,0,cv.width,cv.height); ori=null; msg("AI","B√ôM! ƒê√£ s·∫°ch b√°ch."); } }
    function rs() { if(ori) x.drawImage(ori,0,0,cv.width,cv.height); }
    function sv() { const a=document.createElement('a'); a.download='tb49.png'; a.href=cv.toDataURL(); a.click(); }

    async function go() {
        const i = document.getElementById('m'), v = i.value.trim();
        if(!v) return; msg("S·∫øp", v); i.value = '';
        ldBox.style.display = "block";

        if(v.toLowerCase().includes("v·∫Ω")) {
            // V·∫º ·∫¢NH B·∫∞NG AI
            const aimg = new Image(); aimg.crossOrigin = "anonymous";
            aimg.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(v + ", cinematic, 4k, detail") }?width=1024&height=1024&nologo=true&seed=${Math.floor(Math.random()*1e9)}`;
            aimg.onload = () => {
                cv.width = 1024; cv.height = 1024;
                x.drawImage(aimg, 0, 0, 1024, 1024); ori = aimg;
                ldBox.style.display = "none"; msg("AI", "H√†ng c·ªßa s·∫øp ƒë√¢y!");
            };
            aimg.onerror = () => { ldBox.style.display = "none"; msg("AI", "L·ªói v·∫Ω r·ªìi s·∫øp!"); };
        } else {
            // CHAT V·ªöI GEMINI PRO
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: v }] }] })
                });
                const data = await res.json();
                const reply = data.candidates[0].content.parts[0].text;
                ldBox.style.display = "none";
                msg("AI", reply);
                // ƒê·ªçc c√¢u tr·∫£ l·ªùi b·∫±ng gi·ªçng n√≥i cho s·∫øp nghe lu√¥n
                const s = new SpeechSynthesisUtterance(reply.substring(0, 100));
                s.lang = 'vi-VN'; window.speechSynthesis.speak(s);
            } catch (err) {
                ldBox.style.display = "none";
                msg("AI", "API b·ªã l·ªói ho·∫∑c h·∫øt h·∫°n r·ªìi s·∫øp ∆°i!");
            }
        }
    }

    function msg(s, m) {
        const l = document.getElementById('log');
        l.innerHTML += `<div><b>${s}:</b> ${m}</div>`;
        l.scrollTop = l.scrollHeight;
    }
</script>
</body>
</html>
