<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ThanhBinh49 AI Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0a0a">
    <style>
        :root { --primary: #007aff; --bg: #0a0a0a; --card: #1c1c1e; --text: #ffffff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: -apple-system, system-ui; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        header { padding: 15px; text-align: center; border-bottom: 1px solid #333; font-weight: 800; color: var(--primary); background: rgba(10,10,10,0.9); }
        .canvas-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px; position: relative; }
        canvas { max-width: 100%; max-height: 70%; border-radius: 12px; background: #111; box-shadow: 0 5px 20px rgba(0,0,0,0.5); transition: 0.3s; }
        canvas.loading { opacity: 0.3; filter: blur(10px); }
        .toolbar { display: flex; gap: 8px; overflow-x: auto; padding: 15px 10px; width: 100%; scrollbar-width: none; }
        .toolbar::-webkit-scrollbar { display: none; }
        button { background: var(--card); color: white; border: 1px solid #333; padding: 10px 18px; border-radius: 12px; white-space: nowrap; font-size: 0.85rem; font-weight: 600; }
        button:active { transform: scale(0.9); background: var(--primary); }
        .btn-main { background: var(--primary); border: none; width: calc(100% - 20px); margin: 0 10px 10px 10px; padding: 14px; border-radius: 12px; font-weight: bold; color: white; }
        .chat-container { height: 180px; background: var(--card); margin: 0 10px 15px 10px; border-radius: 20px; display: flex; flex-direction: column; border: 1px solid #333; }
        #chat-history { flex: 1; overflow-y: auto; padding: 12px; font-size: 0.85rem; }
        .chat-input-area { display: flex; padding: 8px; border-top: 1px solid #333; gap: 8px; }
        input { flex: 1; background: #2c2c2e; border: none; padding: 10px 15px; border-radius: 20px; color: white; outline: none; }
    </style>
</head>
<body>

<header>THANHBINH49 AI PRO</header>

<div class="canvas-container">
    <canvas id="mainCanvas"></canvas>
    <div class="toolbar">
        <button onclick="document.getElementById('fileInput').click()">üìÇ M·ªü ·∫£nh</button>
        <button onclick="applyPreset('boost')">üî• Boost</button>
        <button onclick="applyPreset('autoFace')">üë§ AutoFace</button>
        <button onclick="applyPreset('fantasy')">ü¶Ñ Fantasy</button>
        <button onclick="applyPreset('warm')">üçÇ Warm</button>
        <button onclick="resetImage()">üîÑ Reset</button>
    </div>
    <input type="file" id="fileInput" hidden accept="image/*" onchange="handleFile(this)">
    <button class="btn-main" onclick="saveImage()">XU·∫§T ·∫¢NH AI PRO</button>
</div>

<div class="chat-container">
    <div id="chat-history"><i>Em ch√†o anh B√¨nh Pro! Anh mu·ªën t√¢m s·ª± hay v·∫Ω ·∫£nh g√¨ kh√¥ng?</i></div>
    <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="V√≠ d·ª•: V·∫Ω m·ªôt phi h√†nh gia c∆∞·ª°i r·ªìng...">
        <button onclick="handleAI()" style="background:var(--primary); border:none; border-radius:50%; width:40px;">üöÄ</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const chatHistory = document.getElementById('chat-history');
    const chatInput = document.getElementById('chatInput');
    let originalImage = null;

    function handleFile(input) {
        if (input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const scale = (window.innerWidth - 40) / img.width;
                    canvas.width = window.innerWidth - 40;
                    canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    originalImage = img;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function applyPreset(mode) {
        if (!originalImage) return;
        ctx.filter = 'none';
        ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
        let f = '';
        if(mode==='boost') f='contrast(1.4) saturate(1.5)';
        if(mode==='autoFace') f='brightness(1.1) blur(0.2px)';
        if(mode==='fantasy') f='hue-rotate(45deg) saturate(2)';
        if(mode==='warm') f='sepia(0.5) saturate(1.2)';
        ctx.filter = f;
        ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
        ctx.filter = 'none';
    }

    async function handleAI() {
        const text = chatInput.value.trim();
        if (!text) return;
        addLog("B·∫°n", text);
        chatInput.value = '';

        if (text.toLowerCase().includes("v·∫Ω") || text.toLowerCase().includes("t·∫°o ·∫£nh")) {
            addLog("AI", "ƒêang m√∫a c·ªç v·∫Ω cho anh ƒë√¢y...");
            speak("ƒêang m√∫a c·ªç v·∫Ω cho anh ƒë√¢y");
            canvas.classList.add('loading');
            const imageUrl = `https://pollinations.ai/p/${encodeURIComponent(text)}?width=1024&height=1024&seed=${Math.random()}`;
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.onload = () => {
                canvas.classList.remove('loading');
                const scale = (window.innerWidth - 40) / img.width;
                canvas.width = window.innerWidth - 40;
                canvas.height = img.height * scale;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                originalImage = img;
                addLog("AI", "Xong r·ªìi n√® anh B√¨nh ∆°i!");
                speak("Xong r·ªìi n√® anh B√¨nh ∆°i");
            };
            img.src = imageUrl;
        } else {
            const res = "D·∫° em nghe n√® anh B√¨nh, anh ƒë·∫πp trai qu√° l√†m em qu√™n m·∫•t ƒë·ªãnh n√≥i g√¨ r·ªìi!";
            addLog("AI", res);
            speak(res);
        }
    }

    function addLog(s, m) {
        const d = document.createElement('div');
        d.innerHTML = `<b>${s}:</b> ${m}`;
        chatHistory.appendChild(d);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    function speak(t) {
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'vi-VN';
        u.pitch = 1.3;
        window.speechSynthesis.speak(u);
    }

    function saveImage() {
        const link = document.createElement('a');
        link.download = 'ThanhBinh_AI.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    function resetImage() { if(originalImage) ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height); }

    if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
</script>
</body>
</html>
