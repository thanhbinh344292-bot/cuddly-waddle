<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TB49 TIKTOK AI</title>
    <style>
        :root { --primary: #fe2c55; --secondary: #25f4ee; --bg: #000; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'SF Pro Display', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Giao di·ªán Header TikTok */
        .header { display: flex; justify-content: space-between; padding: 15px; align-items: center; border-bottom: 1px solid #222; }
        .logo { font-weight: 900; font-size: 1.2rem; letter-spacing: -1px; }
        .logo span { color: var(--primary); text-shadow: 2px 0 var(--secondary); }

        /* Khu v·ª±c hi·ªÉn th·ªã ·∫£nh ch√≠nh */
        #v { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; background: #0a0a0a; }
        canvas { max-width: 95%; max-height: 95%; border-radius: 12px; transition: all 0.3s; box-shadow: 0 0 30px rgba(254, 44, 85, 0.2); }

        /* Thanh c√¥ng c·ª• Filter tr∆∞·ª£t ngang ki·ªÉu TikTok */
        .filter-bar { display: flex; gap: 15px; overflow-x: auto; padding: 15px; background: rgba(0,0,0,0.8); }
        .f-item { min-width: 70px; text-align: center; font-size: 11px; color: #aaa; }
        .f-btn { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #333; margin-bottom: 5px; background-size: cover; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .f-btn:active { border-color: var(--primary); color: var(--primary); }

        /* Khung Chat ƒë√†m tho·∫°i */
        #chat { height: 200px; background: #111; border-top-left-radius: 20px; border-top-right-radius: 20px; display: flex; flex-direction: column; padding-bottom: env(safe-area-inset-bottom); }
        #log { flex: 1; overflow-y: auto; padding: 15px; font-size: 14px; color: #eee; }
        .in-box { display: flex; padding: 10px 15px; gap: 10px; align-items: center; }
        input { flex: 1; background: #2a2a2a; border: none; color: #fff; padding: 12px 20px; border-radius: 25px; outline: none; }
        .btn-send { background: var(--primary); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 18px; }

        /* N√∫t T·ª± H·ªßy ƒë·ªè ch√≥t */
        .boom-float { position: absolute; right: 10px; top: 10px; background: rgba(255,0,0,0.7); padding: 8px; border-radius: 50%; border: none; color: white; font-size: 12px; z-index: 100; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">TB49 <span>PRO AI</span></div>
        <button onclick="document.getElementById('f').click()" style="background:none; border:1px solid #444; color:#fff; border-radius:5px; padding:5px 10px;">+ T·∫¢I ·∫¢NH</button>
    </div>

    <div id="v">
        <button class="boom-float" onclick="boom()">‚ò¢Ô∏è</button>
        <canvas id="c"></canvas>
        <input type="file" id="f" hidden onchange="ld(event)">
    </div>

    <div class="filter-bar">
        <div class="f-item" onclick="applyFilter('normal')"><div class="f-btn">G·ªëc</div>Normal</div>
        <div class="f-item" onclick="applyFilter('bright')"><div class="f-btn" style="color:#ffcc00">S√°ng</div>Bright</div>
        <div class="f-item" onclick="applyFilter('bw')"><div class="f-btn" style="color:#888">B&W</div>Vintage</div>
        <div class="f-item" onclick="applyFilter('warm')"><div class="f-btn" style="color:#ff7e5f">·∫§m</div>Warm</div>
        <div class="f-item" onclick="applyFilter('cool')"><div class="f-btn" style="color:#00c6ff">L·∫°nh</div>Cool</div>
        <div class="f-item" onclick="sv()"><div class="f-btn" style="background:var(--primary)">üíæ</div>L∆∞u</div>
    </div>

    <div id="chat">
        <div id="log">AI: S·∫øp ∆°i, ƒë√†m tho·∫°i v·ªõi em ho·∫∑c g√µ "v·∫Ω..." ƒë·ªÉ em m√∫a c·ªç!</div>
        <div class="in-box">
            <input type="text" id="m" placeholder="H·ªèi Gemini ho·∫∑c y√™u c·∫ßu v·∫Ω...">
            <button onclick="go()" class="btn-send">üöÄ</button>
        </div>
    </div>

<script>
    const API_KEY = "AIzaSyAosEJtRm3eHM-zVmsIzAMfipoU3v9wEek";
    const cv = document.getElementById('c'), x = cv.getContext('2d');
    let ori = null;

    function ld(e) {
        const r = new FileReader();
        r.onload = (ev) => {
            const img = new Image();
            img.onload = () => {
                const ratio = Math.min(window.innerWidth/img.width, 400/img.height, 1);
                cv.width = img.width * ratio; cv.height = img.height * ratio;
                x.drawImage(img, 0, 0, cv.width, cv.height); ori = img;
                msg("AI", "ƒê√£ t·∫£i ·∫£nh! S·∫øp ch·ªçn Filter hay mu·ªën AI s·ª≠a?");
            };
            img.src = ev.target.result;
        };
        r.readAsDataURL(e.target.files[0]);
    }

    function applyFilter(type) {
        if(!ori) return;
        x.drawImage(ori, 0, 0, cv.width, cv.height);
        const d = x.getImageData(0,0,cv.width,cv.height), data = d.data;
        for(let i=0; i<data.length; i+=4) {
            if(type === 'bright') { data[i]*=1.2; data[i+1]*=1.2; data[i+2]*=1.2; }
            if(type === 'bw') { let avg = (data[i]+data[i+1]+data[i+2])/3; data[i]=data[i+1]=data[i+2]=avg; }
            if(type === 'warm') { data[i]*=1.2; data[i+2]*=0.8; }
            if(type === 'cool') { data[i]*=0.8; data[i+2]*=1.2; }
        }
        x.putImageData(d, 0, 0);
    }

    function boom() { if(confirm("T·ª± h·ªßy to√†n b·ªô?")) { x.clearRect(0,0,cv.width,cv.height); ori=null; msg("AI", "B√πm! ƒê√£ x√≥a d·∫•u v·∫øt."); } }
    function sv() { const a=document.createElement('a'); a.download='tb49_tiktok.png'; a.href=cv.toDataURL(); a.click(); }

    async function go() {
        const i = document.getElementById('m'), v = i.value.trim();
        if(!v) return; msg("S·∫øp", v); i.value = '';

        if(v.toLowerCase().includes("v·∫Ω")) {
            msg("AI", "ƒêang m√∫a b√∫t ki·ªÉu TikTok...");
            const aimg = new Image(); aimg.crossOrigin = "anonymous";
            aimg.src = `https://pollinations.ai/p/${encodeURIComponent(v + ", portrait, tiktok style, 4k") }?width=800&height=1200&model=flux&seed=${Math.random()}`;
            aimg.onload = () => {
                cv.width = 800; cv.height = 1200;
                x.drawImage(aimg, 0, 0, 800, 1200); ori = aimg;
                msg("AI", "·∫¢nh AI c·ª±c ph·∫©m cho s·∫øp!");
            };
        } else {
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: v }] }] })
                });
                const data = await res.json();
                const reply = data.candidates[0].content.parts[0].text;
                msg("AI", reply);
                // ƒê√†m tho·∫°i b·∫±ng gi·ªçng n√≥i
                const s = new SpeechSynthesisUtterance(reply.substring(0, 150));
                s.lang = 'vi-VN'; window.speechSynthesis.speak(s);
            } catch (err) { msg("AI", "Gemini ƒëang b·∫≠n s·∫øp ∆°i!"); }
        }
    }

    function msg(s, m) {
        const l = document.getElementById('log');
        l.innerHTML += `<div><b style="color:var(--secondary)">${s}:</b> ${m}</div>`;
        l.scrollTop = l.scrollHeight;
    }
</script>
</body>
</html>
