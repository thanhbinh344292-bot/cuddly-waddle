<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ThanhBinh49 AI Pro</title>
<meta name="theme-color" content="#1E1E2F">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
*{box-sizing:border-box;}
body{margin:0;font-family:'Inter',sans-serif;background:#121212;color:white;display:flex;flex-direction:column;height:100vh;}
header{padding:14px 20px;text-align:center;font-weight:700;font-size:1.5rem;background:linear-gradient(135deg,#6366f1,#22d3ee);box-shadow:0 4px 12px rgba(0,0,0,0.3);}
main{flex:1;display:flex;flex-direction:row;gap:10px;padding:10px;}
#sidebar-left,#sidebar-right{width:80px;min-width:80px;background:#1E1E2F;border-radius:16px;padding:10px;display:flex;flex-direction:column;gap:10px;overflow:auto;}
#canvas-container{flex:1;display:flex;justify-content:center;align-items:center;position:relative;}
canvas{border-radius:16px;max-width:100%;max-height:80vh;box-shadow:0 10px 20px rgba(0,0,0,0.5);}
button,input[type=range],input[type=text]{border:none;border-radius:12px;padding:8px;font-size:0.95rem;cursor:pointer;transition:0.2s;}
button{background:linear-gradient(135deg,#6366f1,#22d3ee);color:white;font-weight:600;}
button:hover{opacity:0.9;}
input[type=range]{width:60px;transform:rotate(-90deg);margin:auto;}
#chat-box{background:rgba(0,0,0,0.25);padding:10px;border-radius:16px;max-height:200px;overflow-y:auto;backdrop-filter:blur(8px);}
#chat-input{width:calc(100% - 16px);padding:6px;margin-top:6px;border-radius:12px;}
#chat-box div{margin-bottom:6px;font-size:0.9rem;}
</style>
</head>

<body>
<header>ThanhBinh49 AI Pro</header>
<main>
  <div id="sidebar-left">
    <input type="file" id="fileInput" accept="image/*" title="Upload ảnh">
    <input type="range" id="brightness" min="50" max="150" value="100" title="Brightness">
    <input type="range" id="contrast" min="50" max="150" value="100" title="Contrast">
    <button onclick="applyFilters()">Áp dụng</button>
    <button onclick="downloadImage()">Lưu</button>
  </div>

  <div id="canvas-container">
    <canvas id="editor"></canvas>
    <div id="sidebar-right">
      <input type="text" id="textPrompt" placeholder="Mô tả tạo ảnh AI">
      <button onclick="generateFromText()">Tạo ảnh</button>
      <div id="chat-box">
        <input id="chat-input" placeholder="Nhập chat AI..." onkeydown="if(event.key==='Enter'){sendChat()}">
        <button onclick="sendChat()">Gửi</button>
      </div>
    </div>
  </div>
</main>

<script>
const canvas=document.getElementById('editor');
const ctx=canvas.getContext('2d');
let img=new Image();

document.getElementById('fileInput').onchange=e=>{
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=ev=>{
    img.onload=()=>{
      canvas.width=img.width>600?600:img.width;
      canvas.height=img.height>600?600:img.height;
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
    };
    img.src=ev.target.result;
  };
  reader.readAsDataURL(file);
};

function applyFilters(){
  if(!img.src) return;
  ctx.drawImage(img,0,0);
  let data=ctx.getImageData(0,0,canvas.width,canvas.height);
  let b=document.getElementById('brightness').value/100;
  let c=document.getElementById('contrast').value/100;
  for(let i=0;i<data.data.length;i+=4){
    data.data[i]*=b;
    data.data[i+1]*=b;
    data.data[i+2]*=b;
    data.data[i]=((data.data[i]-128)*c)+128;
    data.data[i+1]=((data.data[i+1]-128)*c)+128;
    data.data[i+2]=((data.data[i+2]-128)*c)+128;
  }
  ctx.putImageData(data,0,0);
}

function downloadImage(){
  const a=document.createElement('a');
  a.href=canvas.toDataURL();
  a.download='ThanhBinh49.png';
  a.click();
}

// AI Proxy URL
const PROXY_URL="YOUR_PROXY_URL";

async function generateFromText(){
  const prompt=document.getElementById('textPrompt').value;
  if(!prompt) return alert("Nhập mô tả!");
  try{
    const res=await fetch(PROXY_URL+'/text-to-image',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({prompt})
    });
    const data=await res.json();
    if(data.image){
      const newImg=new Image();
      newImg.onload=()=>{
        canvas.width=newImg.width;
        canvas.height=newImg.height;
        ctx.drawImage(newImg,0,0);
      };
      newImg.src=data.image;
    }
  }catch(e){alert('Lỗi tạo ảnh AI: '+e.message);}
}

async function sendChat(){
  const q=document.getElementById('chat-input');
  if(!q.value) return;
  const chat=document.getElementById('chat-box');
  chat.innerHTML+=`<div><b>Bạn:</b> ${q.value}</div>`;
  const prompt=q.value;
  q.value='';
  try{
    const res=await fetch(PROXY_URL+'/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({prompt})
    });
    const data=await res.json();
    chat.innerHTML+=`<div><b>AI:</b> ${data.answer||'Không có phản hồi'}</div>`;
    chat.scrollTop=chat.scrollHeight;
    const u=new SpeechSynthesisUtterance(data.answer||'');
    u.lang='vi-VN';
    speechSynthesis.speak(u);
  }catch(e){alert('Lỗi chat AI: '+e.message);}
}
</script>
</body>
</html>
