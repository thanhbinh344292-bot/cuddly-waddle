<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TB49 AI PRO v3.0</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: -apple-system, sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        header { padding: 12px; text-align: center; color: #007aff; font-weight: 800; border-bottom: 1px solid #222; font-size: 1.1rem; }
        #v { flex: 1; display: flex; align-items: center; justify-content: center; background: #0a0a0a; padding: 10px; overflow: hidden; }
        canvas { max-width: 100%; max-height: 100%; border-radius: 12px; box-shadow: 0 0 20px rgba(0,122,255,0.3); background: #111; }
        .tools { padding: 12px; display: flex; gap: 10px; overflow-x: auto; background: #111; border-top: 1px solid #222; -webkit-overflow-scrolling: touch; }
        button { background: #222; color: #fff; border: 1px solid #333; padding: 12px 20px; border-radius: 12px; font-weight: 600; white-space: nowrap; font-size: 14px; }
        button:active { background: #007aff; transform: scale(0.95); }
        #chat { height: 160px; background: #000; border-top: 1px solid #222; display: flex; flex-direction: column; }
        #log { flex: 1; overflow-y: auto; padding: 12px; font-size: 13px; color: #999; line-height: 1.4; }
        .input-box { display: flex; padding: 10px; gap: 8px; background: #111; border-top: 1px solid #222; }
        input { flex: 1; background: #222; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; outline: none; font-size: 16px; }
    </style>
</head>
<body>

    <header>THANHBINH49 AI PRO</header>

    <div id="v"><canvas id="c"></canvas></div>

    <div class="tools">
        <button onclick="document.getElementById('f').click()">üìÇ M·ªû ·∫¢NH</button>
        <button onclick="ef()" style="color:#ffcc00; border-color:#ffcc00;">üî• BOOST</button>
        <button onclick="rs()">üîÑ RESET</button>
        <button onclick="sv()" style="background:#007aff; border:none;">üíæ L∆ØU ·∫¢NH</button>
    </div>

    <input type="file" id="f" hidden accept="image/*" onchange="ld(event)">

    <div id="chat">
        <div id="log"><b>AI:</b> ƒê√£ s·∫µn s√†ng "ƒë·ªô" ·∫£nh cho s·∫øp B√¨nh!</div>
        <div class="input-box">
            <input type="text" id="m" placeholder="V·∫Ω g√¨ ƒë√≥ (VD: v·∫Ω con r·ªìng)...">
            <button onclick="go()" style="border-radius:50%; width:46px; height:46px; padding:0; background:#007aff; border:none;">üöÄ</button>
        </div>
    </div>

<script>
    const cv = document.getElementById('c'), x = cv.getContext('2d');
    let ori = null;

    // 1. N·∫°p ·∫£nh
    function ld(e) {
        const r = new FileReader();
        r.onload = (ev) => {
            const img = new Image();
            img.onload = () => {
                const max = 1200; // Gi·ªõi h·∫°n k√≠ch th∆∞·ªõc ƒë·ªÉ iPhone ko b·ªã lag
                let w = img.width, h = img.height;
                if(w > max || h > max) { const s = Math.min(max/w, max/h); w *= s; h *= s; }
                cv.width = w; cv.height = h;
                x.clearRect(0, 0, w, h);
                x.drawImage(img, 0, 0, w, h);
                ori = img;
                msg("AI", "ƒê√£ n·∫°p ·∫£nh xong!");
            };
            img.src = ev.target.result;
        };
        r.readAsDataURL(e.target.files[0]);
    }

    // 2. H√†m Boost (D√πng Pixel Manipulation - Ch·∫•p m·ªçi lo·∫°i iPhone)
    function ef() {
        if(!ori) return msg("AI", "S·∫øp ∆°i, ch∆∞a ch·ªçn ·∫£nh m√†!");
        x.drawImage(ori, 0, 0, cv.width, cv.height); // V·∫Ω l·∫°i ·∫£nh g·ªëc
        
        const imgData = x.getImageData(0, 0, cv.width, cv.height);
        const d = imgData.data;
        
        for (let i = 0; i < d.length; i += 4) {
            d[i] = Math.min(255, d[i] * 1.6);     // R
            d[i+1] = Math.min(255, d[i+1] * 1.6); // G
            d[i+2] = Math.min(255, d[i+2] * 1.6); // B
        }
        x.putImageData(imgData, 0, 0);
        msg("AI", "ƒê√£ √©p s√°ng! S·∫øp th·∫•y r√µ ch∆∞a?");
    }

    // 3. Reset & L∆∞u
    function rs() { if(ori) { x.drawImage(ori, 0, 0, cv.width, cv.height); msg("AI", "V·ªÅ zin!"); } }
    function sv() { const a = document.createElement('a'); a.download='tb49.png'; a.href=cv.toDataURL('image/png'); a.click(); }

    // 4. AI V·∫Ω ·∫¢nh
    async function go() {
        const i = document.getElementById('m'), v = i.value.trim();
        if(!v) return; msg("B·∫°n", v); i.value = '';
        if(v.toLowerCase().includes("v·∫Ω")) {
            msg("AI", "ƒêang m√∫a c·ªç, s·∫øp ƒë·ª£i t√≠...");
            const aimg = new Image(); aimg.crossOrigin = "anonymous";
            aimg.src = "https://pollinations.ai/p/" + encodeURIComponent(v) + "?width=1024&height=1024&seed=" + Math.random();
            aimg.onload = () => {
                cv.width = 1024; cv.height = 1024;
                x.drawImage(aimg, 0, 0, 1024, 1024);
                ori = aimg;
                msg("AI", "Xong! T√°c ph·∫©m ƒë√¢y s·∫øp.");
                const s = new SpeechSynthesisUtterance("Xong r·ªìi s·∫øp");
                s.lang = 'vi-VN'; window.speechSynthesis.speak(s);
            };
        } else { msg("AI", "D·∫° em nghe n√® s·∫øp B√¨nh!"); }
    }

    function msg(s, m) {
        const l = document.getElementById('log');
        l.innerHTML += `<div><b>${s}:</b> ${m}</div>`;
        l.scrollTop = l.scrollHeight;
    }
</script>
</body>
</html>
